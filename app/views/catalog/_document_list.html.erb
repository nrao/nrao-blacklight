<%= javascript_include_tag 'mktree.js' %>
<%= stylesheet_link_tag 'mktree', 'doctree' %>

<% # container for all documents in index view -%>
<% if @response.total > 0 %>
<a href="#" onclick="expandTree('documents'); return false;">Expand All</a>&nbsp;&nbsp;&nbsp;
<a href="#" onClick="collapseTree('documents'); return false;">Collapse All</a>&nbsp;&nbsp;&nbsp;
<% end %>
<ul id="documents" class="mktree">
  
  <% # loop thru each doc -%>
  <% @response.docs.each_with_index do |document,counter| %>

    <% # container for a single doc -%>
    <li><%= counter + 1 + @response.params[:start].to_i %>. <%= h document["session_id"] %>
      <ul class="document">
        <% if document.get "title" %>
        <li><%= h document.get("title") %></li>
        <% end -%>
        <% if document.get "investigator_concise" %>
        <li><%= h document.get("investigator_concise") %></li>
        <% end -%>
        <table class="scanlist">
          <tr><th>#</th><th>Object</th><th>Band</th><th>Receiver</th><th>Backend</th><th>Obstype</th><th>RA (2000)</th><th>Dec (2000)</th><th>Skyfreq (GHz)</th><th></th></tr>
          <% @collapsed.default = [] %>
          <% @collapsed[document["id"]].each do |scan| %>
          <tr><td><%= h scan["scan"] %></td><td><% if scan["object"].length > 9 %><%= h scan["object"][0..6] + "..." %><% else %><%= h scan["object"] %><% end %></td><td><%= h scan["band"] %></td><td><%= h scan["receiver"] %></td><td><%= h scan["backend"] %></td><td><%= h scan["obstype"] %></td><td><%= h scan["ra"] %></td><td><%= h scan["dec"] %></td><td><%= h scan["skyfreq_concise"] %></td><td><%= link_to_with_data(:more, catalog_path(scan["id"]), {:method => :put}) %></td></tr>
          <% end %>
        </table>
      </ul>
    </li>
    
  <% end %>
</ul>
<% if @response.total > 0 %>
<a href="#" onclick="expandTree('documents'); return false;">Expand All</a>&nbsp;&nbsp;&nbsp;
<a href="#" onClick="collapseTree('documents'); return false;">Collapse All</a>&nbsp;&nbsp;&nbsp;
<% end %>
