<?xml version="1.0" encoding="UTF-8" ?>
<!--Condensed schema.  See tutorial example schema.xml for notes on config.-->
<schema name="proposals" version="1.1">
n  <types>
    <fieldType name="string" class="solr.StrField" sortMissingLast="true" omitNorms="true"/>
    <fieldType name="date" class="solr.DateField" sortMissingLast="true" omitNorms="true"/>
    <fieldType name="text" class="solr.TextField" positionIncrementGap="100">
      <analyzer type="index">
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.StopFilterFactory"
                ignoreCase="true"
                words="stopwords.txt"
                enablePositionIncrements="true"
                />
        <filter class="solr.WordDelimiterFilterFactory" generateWordParts="1" generateNumberParts="1" catenateWords="1" catenateNumbers="1" catenateAll="0" splitOnCaseChange="1"/>
        <filter class="solr.LowerCaseFilterFactory"/>
        <filter class="solr.EnglishPorterFilterFactory" protected="protwords.txt"/>
        <filter class="solr.RemoveDuplicatesTokenFilterFactory"/>
      </analyzer>
      <analyzer type="query">
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.SynonymFilterFactory" synonyms="synonyms.txt" ignoreCase="true" expand="true"/>
        <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt"/>
        <filter class="solr.WordDelimiterFilterFactory" generateWordParts="1" generateNumberParts="1" catenateWords="0" catenateNumbers="0" catenateAll="0" splitOnCaseChange="1"/>
        <filter class="solr.LowerCaseFilterFactory"/>
        <filter class="solr.EnglishPorterFilterFactory" protected="protwords.txt"/>
        <filter class="solr.RemoveDuplicatesTokenFilterFactory"/>
      </analyzer>
    </fieldType>
    <fieldType name="textTight" class="solr.TextField" positionIncrementGap="100" >
      <analyzer>
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.SynonymFilterFactory" synonyms="synonyms.txt" ignoreCase="true" expand="false"/>
        <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt"/>
        <filter class="solr.WordDelimiterFilterFactory" generateWordParts="0" generateNumberParts="0" catenateWords="1" catenateNumbers="1" catenateAll="0"/>
        <filter class="solr.LowerCaseFilterFactory"/>
        <filter class="solr.EnglishPorterFilterFactory" protected="protwords.txt"/>
        <filter class="solr.RemoveDuplicatesTokenFilterFactory"/>
      </analyzer>
    </fieldType>
     <fieldType name="alphaOnlySort" class="solr.TextField" sortMissingLast="true" omitNorms="true">
      <analyzer>
        <tokenizer class="solr.KeywordTokenizerFactory"/>
        <filter class="solr.LowerCaseFilterFactory" />
        <filter class="solr.TrimFilterFactory" />
        <filter class="solr.PatternReplaceFilterFactory" pattern="([^a-z\d])" replacement="" replace="all" />
      </analyzer>
    </fieldType>
</types>

 <fields>
   <!--Domain-specific fields.-->
   <field name="id" type="string" indexed="true" stored="true"/>
   <field name="proposal_title" type="string" indexed="true" stored="true"/>
   <field name="abstract" type="text" indexed="true" stored="true"/>
   <field name="principal_investigator" type="string" indexed="true" stored="true"/>
   <field name="investigators" type="string" indexed="true" stored="true" multiValued="true"/>
   <field name="contact" type="text" indexed="true" stored="true"/>
   <field name="editor" type="text" indexed="true" stored="true"/>
   <!-- Need to interpret these as dates... -->
   <field name="create_date" type="text" indexed="true" stored="true"/>
   <field name="modify_date" type="text" indexed="true" stored="true"/>
   <field name="submit_date" type="text" indexed="true" stored="true"/>
   <field name="total_time" type="text" indexed="true" stored="true"/>
   <field name="principal_telescope" type="string" indexed="true" stored="true"/>
   <field name="telescopes" type="string" indexed="true" stored="true" multiValued="true"/>
   <field name="proposal_id" type="string" indexed="true" stored="true"/>
   <field name="legacy_id" type="string" indexed="true" stored="true"/>
   <field name="proposal_type" type="string" indexed="true" stored="true"/>
   <field name="observing_type" type="string" indexed="true" stored="true" multiValued="true"/>
   <field name="other_observing_type" type="string" indexed="true" stored="true"/>
   <field name="rapid_response_type" type="string" indexed="true" stored="true"/>
   <field name="related_proposal" type="string" indexed="true" stored="true"/>
   <field name="joint_proposal" type="string" indexed="true" stored="true"/>
   <field name="scientific_category" type="string" indexed="true" stored="true" multiValued="true"/>
   <field name="dissertation_plan" type="string" indexed="true" stored="true"/>
   <field name="year_submitted" type="string" indexed="true" stored="true"/>

   <!--Redundant fields, to index some fields in different ways.-->
   <field name="title" type="text" indexed="true" stored="false"/>
   <field name="related" type="text" indexed="true" stored="false"/>
   <field name="telescope" type="string" indexed="true" stored="false" multiValued="true"/>
   <field name="principal" type="text" indexed="true" stored="false"/>
   <field name="pi" type="text" indexed="true" stored="false"/>
   <field name="investigator" type="text" indexed="true" stored="false" multiValued="true"/>
   <field name="i" type="text" indexed="true" stored="false" multiValued="true"/>
   <field name="date" type="text" indexed="true" stored="false"/>

   <!--Fields for blacklight.-->
   <field name="format_code" type="text" indexed="true" stored="true" default="coversheet"/>
   <field name="telescope_facet" type="string" indexed="true" stored="false" multiValued="true"/>
   <field name="year_facet" type="string" indexed="true" stored="false"/>
   <field name="proposal_type_facet" type="string" indexed="true" stored="false"/>
   <field name="observing_type_facet" type="string" indexed="true" stored="false" multiValued="true"/>
   <field name="rapid_response_type_facet" type="string" indexed="true" stored="false"/>
   <field name="joint_proposal_facet" type="string" indexed="true" stored="false"/>
   <field name="scientific_category_facet" type="string" indexed="true" stored="false" multiValued="true"/>
   <field name="dissertation_plan_facet" type="string" indexed="true" stored="false"/>

   <field name="date_sort" type="alphaOnlySort" indexed="true" stored="false"/>
   <field name="telescope_sort" type="alphaOnlySort" indexed="true" stored="false"/>
   <field name="proposal_id_sort" type="alphaOnlySort" indexed="true" stored="false"/>
   <field name="legacy_id_sort" type="alphaOnlySort" indexed="true" stored="false"/>

   <!--Useful system fields.-->
   <field name="text" type="text" indexed="true" stored="false" multiValued="true"/>
   <field name="timestamp" type="date" indexed="true" stored="true" default="NOW" multiValued="false"/>

   <!--Everything else is allowed, as text fields.-->
   <dynamicField name="*" type="text" indexed="true" stored="false" multiValued="true"/>
 </fields>

 <!--system_id format: <foreign_system/>.<foreign_key/>, e.g. 'opensky.110'-->
 <uniqueKey>id</uniqueKey>
 <defaultSearchField>text</defaultSearchField>
 <solrQueryParser defaultOperator="AND"/>

 <!--Copy fields for generic term searches.-->
 <copyField source="proposal_title" dest="text"/>
 <copyField source="abstract" dest="text"/>
 <copyField source="principal_investigator" dest="text"/>
 <copyField source="investigators" dest="text"/>
 <!-- TODO - should we use deadline date instead, and use it for facet and sort? -->
 <copyField source="submit_date" dest="text"/>
 <copyField source="telescopes" dest="text"/>
 <copyField source="proposal_id" dest="text"/>
 <copyField source="legacy_id" dest="text"/>
 <copyField source="proposal_type" dest="text"/>
 <copyField source="observing_type" dest="text"/>
 <copyField source="other_observing_type" dest="text"/>
 <copyField source="rapid_response_type" dest="text"/>
 <copyField source="scientific_category" dest="text"/>

 <!--Copy fields for alternate lookup.-->
 <copyField source="proposal_title" dest="title"/>
 <copyField source="related_proposal" dest="related"/>
 <copyField source="principal_investigator" dest="principal"/>
 <copyField source="principal_investigator" dest="pi"/>
 <copyField source="investigators" dest="investigator"/>
 <copyField source="investigators" dest="i"/>
 <copyField source="submit_date" dest="date"/>

 <!--Copy fields for facets.-->
 <copyField source="telescopes" dest="telescope_facet"/>
 <copyField source="year_submitted" dest="year_facet"/>
 <copyField source="proposal_type" dest="proposal_type_facet"/>
 <copyField source="observing_type" dest="observing_type_facet"/>
 <copyField source="other_observing_type" dest="observing_type_facet"/>
 <copyField source="rapid_response_type" dest="rapid_response_type_facet"/>
 <copyField source="joint_proposal" dest="joint_proposal_facet"/>
 <copyField source="scientific_category" dest="scientific_category_facet"/>
 <copyField source="dissertation_plan" dest="dissertation_plan_facet"/>

 <copyField source="submit_date" dest="date_sort"/>
 <copyField source="principal_telescope" dest="telescope_sort"/>
 <copyField source="proposal_id" dest="proposal_id_sort"/>
 <copyField source="legacy_id" dest="legacy_id_sort"/>

 <!--Copy fields for sort fields.-->
</schema>
